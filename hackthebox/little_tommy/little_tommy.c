//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2018 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

// --------------------- Global Variables ---------------------

struct _IO_FILE * g1 = NULL; // 0x804a040
char * g2; // 0x804a048
int32_t g3 = 0; // 0x804a04c

// ------------------------ Functions -------------------------

// Address range: 0x804865c - 0x804895f
int main(int argc, char ** argv) {
    puts("\n#################### Welcome to Little Tommy's Handy yet Elegant and Advanced Program ####################");
    // branch -> 0x8048693
    while (true) {
        // 0x8048693
        printf("\n1. Create account\n2. Display account\n3. Delete account\n4. Add memo\n5. Print flag\n\nPlease enter an operation number: ");
        int32_t v1 = 0x1000000 * getchar() / 0x1000000; // 0x80486a8_0
        // branch -> 0x80486af
        while (true) {
          lab_0x80486af:;
            // 0x80486af
            int32_t v2; // 0x80488f0_3
            int32_t len; // 0x8048748
            int32_t str;
            int32_t v3;
            char * v4;
            char * v5;
            char * v6;
            switch ((char)v7) {
                case 10: {
                    // 0x80486cc
                    int32_t c; // 0x80486a3
                    switch (v1) {
                        case 49: {
                            // 0x80486e4
                            g2 = malloc(72);
                            printf("\nFirst name: ");
                            fgets((char *)&str, 256, g1);
                            strncpy(g2, (char *)&str, 30);
                            len = strlen(g2);
                            v3 = (int32_t)g2;
                            if (len > 30) {
                              lab_0x8048773:
                                // 0x8048773
                                *(char *)(v3 + 31) = 0;
                                // branch -> 0x804877c
                            } else {
                              lab_0x804875f:
                                // 0x804875f
                                *(char *)(len - 1 + v3) = 0;
                                // branch -> 0x804877c
                            }
                            // 0x804877c
                            printf("Last name: ");
                            fgets((char *)&str, 256, g1);
                            strncpy((char *)((int32_t)g2 + 32), (char *)&str, 30);
                            int32_t len2 = strlen((char *)((int32_t)g2 + 32)); // 0x80487d2
                            int32_t v8 = (int32_t)g2;
                            if (len2 > 30) {
                                // 0x80487fe
                                *(char *)(v8 + 63) = 0;
                                // branch -> 0x8048807
                            } else {
                                // 0x80487e9
                                *(char *)(len2 + 31 + v8) = 0;
                                // branch -> 0x8048807
                            }
                            // 0x8048807
                            printf("\nThank you, your account number %d.\n", (int32_t)g2);
                            // branch -> 0x8048693
                            break;
                        }
                        case 50: {
                            // 0x8048822
                            v4 = g2;
                            if (v4 == NULL) {
                              lab_0x804882b:
                                // 0x804882b
                                puts("\nSorry, no account found.");
                                // branch -> 0x8048693
                                break;
                            } else {
                              lab_0x8048840:;
                                int32_t v9 = (int32_t)v4;
                                int32_t v10 = *(int32_t *)(v9 + 64); // 0x8048845
                                printf("\n################ Account no. %d ################\nFirst name: %s\nLast name: %s\nAccount balance: %d\n\n", v9, v4, (char *)(v9 + 32), v10);
                                // branch -> 0x8048693
                                break;
                            }
                            while (true) {
                                // 0x8048693
                                printf("\n1. Create account\n2. Display account\n3. Delete account\n4. Add memo\n5. Print flag\n\nPlease enter an operation number: ");
                                c = getchar();
                                v1 = 0x1000000 * c / 0x1000000;
                                // branch -> 0x80486af
                                break;
                            }
                            break;
                        }
                        case 51: {
                            // 0x8048875
                            v5 = g2;
                            if (v5 == NULL) {
                              lab_0x804887e:
                                // 0x804887e
                                puts("\nSorry, no account found.");
                                // branch -> 0x8048693
                                break;
                            } else {
                              lab_0x8048893:
                                // 0x8048893
                                free(v5);
                                puts("\nAccount deleted successfully");
                                // branch -> 0x8048693
                                break;
                            }
                            while (true) {
                                // 0x8048693
                                printf("\n1. Create account\n2. Display account\n3. Delete account\n4. Add memo\n5. Print flag\n\nPlease enter an operation number: ");
                                c = getchar();
                                v1 = 0x1000000 * c / 0x1000000;
                                // branch -> 0x80486af
                                break;
                            }
                            break;
                        }
                        case 52: {
                            // 0x80488b9
                            puts("\nPlease enter memo:");
                            fgets((char *)&str, 256, g1);
                            v2 = (int32_t)strdup((char *)&str);
                            g3 = v2;
                            printf("\nThank you, please keep this reference number number safe: %d.\n", v2);
                            // branch -> 0x8048693
                            break;
                        }
                        case 53: {
                            // 0x8048915
                            v6 = g2;
                            if (v6 != NULL) {
                              lab_0x804891e:
                                // 0x804891e
                                if (*(int32_t *)((int32_t)v6 + 64) == 0x6b637566) {
                                    // 0x804892d
                                    system("/bin/cat flag");
                                    // branch -> 0x8048693
                                    break;
                                }
                            }
                          lab_0x804893f:
                            // 0x804893f
                            puts("\nNope.");
                            // branch -> 0x8048693
                            break;
                        }
                    }
                    while (true) {
                        // 0x8048693
                        printf("\n1. Create account\n2. Display account\n3. Delete account\n4. Add memo\n5. Print flag\n\nPlease enter an operation number: ");
                        v1 = 0x1000000 * getchar() / 0x1000000;
                        // branch -> 0x80486af
                        break;
                    }
                    break;
                }
                case -1: {
                    // 0x80486cc
                    switch (v1) {
                        case 49: {
                            // 0x80486e4
                            g2 = malloc(72);
                            printf("\nFirst name: ");
                            fgets((char *)&str, 256, g1);
                            strncpy(g2, (char *)&str, 30);
                            len = strlen(g2);
                            v3 = (int32_t)g2;
                            if (len > 30) {
                                goto lab_0x8048773;
                            }
                            goto lab_0x804875f;
                            break;
                        }
                        case 50: {
                            // 0x8048822
                            v4 = g2;
                            if (v4 == NULL) {
                                goto lab_0x804882b;
                            }
                            goto lab_0x8048840;
                            break;
                        }
                        case 51: {
                            // 0x8048875
                            v5 = g2;
                            if (v5 == NULL) {
                                goto lab_0x804887e;
                            }
                            goto lab_0x8048893;
                            break;
                        }
                        case 52: {
                            // 0x80488b9
                            puts("\nPlease enter memo:");
                            fgets((char *)&str, 256, g1);
                            v2 = (int32_t)strdup((char *)&str);
                            g3 = v2;
                            printf("\nThank you, please keep this reference number number safe: %d.\n", v2);
                            // branch -> 0x8048693
                            break;
                        }
                        case 53: {
                            // 0x8048915
                            v6 = g2;
                            if (v6 == NULL) {
                                goto lab_0x804893f;
                            }
                            goto lab_0x804891e;
                            break;
                        }
                    }
                    while (true) {
                        // 0x8048693
                        printf("\n1. Create account\n2. Display account\n3. Delete account\n4. Add memo\n5. Print flag\n\nPlease enter an operation number: ");
                        v1 = 0x1000000 * getchar() / 0x1000000;
                        // branch -> 0x80486af
                        break;
                    }
                    break;
                }
                default: {
                    goto lab_0x80486af;
                }
            }
        }
    }
}

// --------------- Dynamically Linked Functions ---------------

// char * fgets(char * restrict s, int n, FILE * restrict stream);
// void free(void * ptr);
// int getchar(void);
// void * malloc(size_t size);
// int printf(const char * restrict format, ...);
// int puts(const char * s);
// char * strdup(const char * s);
// size_t strlen(const char * s);
// char * strncpy(char * restrict dest, const char * restrict src, size_t n);
// int system(const char * command);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (5.4.0)
// Detected functions: 1
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2018-06-08 14:30:29
